<!DOCTYPE html> 
<html>
<head>
<meta charset="utf-8">
<title>DEMO APP</title>
<link href="jquery.mobile-1.3.2.min.css" rel="stylesheet" type="text/css"/>
<link href="jquery.mobile.structure-1.3.2.min.css" rel="stylesheet" type="text/css"/>
<script src="phonegap.js"></script>
<script src="jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="jquery.mobile-1.3.2.min.js" type="text/javascript"></script>
<script type="text/javascript" charset="utf-8">

	$(document).on('deviceready', onDeviceReady);
	

	function onDeviceReady(){

		$('#btnCamera').on('click', function() {
			sessionStorage.removeItem('imagepath');
			navigator.camera.getPicture(onSuccessCamera, onErrorCamera, {destinationType : Camera.DestinationType.FILE_URI , 
																        sourceType : Camera.PictureSourceType.CAMERA,
																        allowEdit : false,
																	    targetWidth:  400,
																        targetHeight: 400,
																    	quality : 80,
																    	correctOrientation : true,
																    	saveToPhotoAlbum : true});
												
		});
	}

	function onSuccessCamera(imageData){
		var imagen = $('.capture > img');
			imagen.attr( 'src', imageData );
			imagen.css( 'display', 'block');
			movePic(imageData);
			$.mobile.changePage("#page2", "slideup");
	}

	function onErrorCamera(message){
		console.log("Error:" + message);
	}


	function movePic(file){ 
	    window.resolveLocalFileSystemURI(file, resolveOnSuccess, resOnError); 
	} 

	//Callback function when the file system uri has been resolved
	function resolveOnSuccess(entry){ 
	    var d = new Date();
	    var n = d.getTime();
	    //new file name
	    var newFileName = n + ".jpg";
	    var myFolderApp = "Demo";

	    window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, function(fileSys) {      
	    //The folder is created if doesn't exist
	    fileSys.root.getDirectory( myFolderApp,
	                    {create:true, exclusive: false},
	                    function(directory) {
	                        entry.moveTo(directory, newFileName,  successMove, resOnError);
	                    },
	                    resOnError);
	                    },
	    resOnError);
	}

	//Callback function when the file has been moved successfully - inserting the complete path
	function successMove(entry) {
	    //Store imagepath in session for future use
	    // like to store it in database
	    sessionStorage.setItem('imagepath', entry.fullPath);
	}

	function resOnError(error) {
	    alert(error.code);
	}
</script>
</head> 
<body> 

<div data-role="page" id="page">
	<div data-role="header">
		<h3>NOMBRE SUPERVISOR</h3>
	</div>
	<div data-role="content">	
		<ul data-role="listview">
			<li><a href="#page2">TIENDA 1</a></li>
            <li><a href="#page3">TIENDA 2</a></li>
			<li><a href="#page4">TIENDA 3</a></li>
		</ul>
	</div>
	<div data-role="footer">
		<h4>Depto Informática Eurofashion</h4>
	</div>
</div>

<div data-role="page" id="page2">
	<div data-role="header">
		<h1>Página dos</h1>
	</div>
	<div data-role="content">	
        <a href="#" data-role="button" id="btnCamera">Capture a photo with camera</a>
        <a href="#" data-role="button" id="open_lib_button">Open Photo Library</a>
        <a href="#" data-role="button" id="open_alb_button">Open saved photo album</a>
	</div>
	<div class="capture">
		<img src="" alt="">
	</div>
	<div data-role="footer">
		<h4>Depto Informática Eurofashion</h4>
	</div>
</div>

<div data-role="page" id="page3">
	<div data-role="header">
		<h1>Página tres</h1>
	</div>
	<div data-role="content">	
		Contenido		
	</div>
	<div data-role="footer">
		<h4>Depto Informática Eurofashion</h4>
	</div>
</div>

<div data-role="page" id="page4">
	<div data-role="header">
		<h1>Página cuatro</h1>
	</div>
	<div data-role="content">	
		Contenido		
	</div>
	<div data-role="footer">
		<h4>Depto Informática Eurofashion</h4>
	</div>
</div>

</body>
</html>