<!DOCTYPE html> 
<html>
<head>
<meta charset="utf-8">
<title>DEMO APP MOD</title>
<link href="jquery.mobile-1.3.2.min.css" rel="stylesheet" type="text/css"/>
<link href="jquery.mobile.structure-1.3.2.min.css" rel="stylesheet" type="text/css"/>
<script src="phonegap.js"></script>
<script src="jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="jquery.mobile-1.3.2.min.js" type="text/javascript"></script>
<script src="db.js"></script>
<script type="text/javascript" charset="utf-8">

	$(document).on('deviceready', onDeviceReady);

	function onDeviceReady(){

		$('#btnCamera').on('click', function() {
			sessionStorage.removeItem('imagepath');
			navigator.camera.getPicture(onSuccessCamera, onErrorCamera, {destinationType : Camera.DestinationType.FILE_URI , 
																        sourceType : Camera.PictureSourceType.CAMERA,
																        allowEdit : false,
																	    targetWidth:  400,
																        targetHeight: 400,
																    	quality : 80,
																    	correctOrientation : true,
																    	saveToPhotoAlbum : true});
												
		});
	}

	function onSuccessCamera(imageData){
		var imagen = $('.capture > img');
			imagen.attr( 'src', imageData );
			imagen.css( 'display', 'block');
			movePic(imageData);
			$.mobile.changePage("#page6", "slideup");
	}

	function onErrorCamera(message){
		console.log("Error:" + message);
	}


	function movePic(file){ 
	    window.resolveLocalFileSystemURI(file, resolveOnSuccess, resOnError); 
	} 

	//Callback function when the file system uri has been resolved
	function resolveOnSuccess(entry){ 
	    var d = new Date();
	    var n = d.getTime();
	    //new file name
	    var newFileName = n + ".jpg";
	    var myFolderApp = "Demo";

	    window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, function(fileSys) {      
	    //The folder is created if doesn't exist
	    fileSys.root.getDirectory( myFolderApp,
	                    {create:true, exclusive: false},
	                    function(directory) {
	                        entry.moveTo(directory, newFileName,  successMove, resOnError);
	                    },
	                    resOnError);
	                    },
	    resOnError);
	}

	//Callback function when the file has been moved successfully - inserting the complete path
	function successMove(entry) {
	    //Store imagepath in session for future use
	    // like to store it in database
	    sessionStorage.setItem('imagepath', entry.fullPath);
	}

	function resOnError(error) {
	    alert(error.code);
	}
</script>
</head> 
<body> 

<div data-role="page" id="page">
	<div data-role="header">
		<h3>NOMBRE SUPERVISOR</h3>
	</div>
	<div data-role="content">	
		<ul data-role="listview" data-filter="true" data-filter-placeholder="Ingrese Tienda">
			<li><a href="#page2">TIENDA 1</a></li>
            <li><a href="#page3">TIENDA 2</a></li>
			<li><a href="#page4">TIENDA 33</a></li>
			<li><a href="#">TIENDA N</a></li>
		</ul>
	</div>
	<div data-role="footer">
		<h4>Depto Informática Eurofashion</h4>
	</div>
</div>

<div data-role="page" id="page2">
	<div data-role="header">
		<h1>ENCUENTAS TIENDA 1</h1>
	</div>
	<ul data-role="listview" >
		<li><a href="#page5">ENCUESTA 1</a></li>
        <li><a href="">ENCUESTA 2</a></li>
		<li><a href="">ENCUESTA 3</a></li>
		<li><a href="">ENCUESTA N</a></li>
	</ul>
	
</div>

<div data-role="page" id="page3">
	<div data-role="header">
		<h1>Página tres</h1>
	</div>
	<div data-role="content">	
		Contenido		
	</div>
	<div data-role="footer">
		<h4>Depto Informática Eurofashion</h4>
	</div>
</div>

<div data-role="page" id="page4">
	<div data-role="header">
		<h1>Página cuatro</h1>
	</div>
	<div data-role="content">	
		Contenido		
	</div>
	<div data-role="footer">
		<h4>Depto Informática Eurofashion</h4>
	</div>
</div>
<div data-role="page" id="page5">
	<div data-role="header">
		<h3>PROMOCION X</h3>
	</div>
	<div data-role="fieldcontain">
	  <fieldset data-role="controlgroup">
	    <legend>Del POP marque todo lo que se cumple:</legend>
	      <input type="checkbox" name="checkbox-1a" id="checkbox-1a" class="custom" />
	      <label for="checkbox-1a">POP está en buen estado</label>
	 
	      <input type="checkbox" name="checkbox-2a" id="checkbox-2a" class="custom" />
	      <label for="checkbox-2a">Está puesto el atril con pizarra.</label>
	 
	      <input type="checkbox" name="checkbox-3a" id="checkbox-3a" class="custom" />
	      <label for="checkbox-3a">Esta la pizarra escrita de acuerdo a formato enviado</label>
	 
	      <input type="checkbox" name="checkbox-4a" id="checkbox-4a" class="custom" />
	      <label for="checkbox-4a">Ninguna de las anteriores</label>
	    </fieldset>
	    <a href="#page6" data-role="button" >NEXT</a>
        <button id="addButton">Guardar</button>
        <button id="consultar">Consultar</button>
        <div id="results">MSG</div>
	</div>
	<div data-role="footer">
		<h4>Depto Informática Eurofashion</h4>
	</div>
</div>

<div data-role="page" id="page6">
	<div data-role="content">	
	    <a href="#" data-role="button" id="btnCamera">Tomar foto de la vitrina</a>
	</div>

	<div class="capture" style="text-align:center;">
		<img src="" alt="" style="margin-left:5%">
	</div>
</div>
</body>
</html>